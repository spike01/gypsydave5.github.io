<!DOCTYPE html>

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      (Basic) Lazy Evaluation and Memoization in JavaScript &middot; gypsydave5
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          gypsydave5
        </a>
      </h1>
      <p class="lead">The blog of David Wickes, software developer</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About me</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <a class="sidebar-nav-item" href="https://github.com/gypsydave5">GitHub</a>
      <a class="sidebar-nav-item" href="https://twitter.com/gypsydave5">Twitter</a>
      <a class="sidebar-nav-item" href="mailto:dave@gypsydave5.com">Email</a>

    </nav>

    <p>&copy; 2015. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div>
  <h1 class="post-title">(Basic) Lazy Evaluation and Memoization in JavaScript</h1>
  <span class="post-date">21 Mar 2015</span>
  <p>Calculation takes time and effort. If I needed to know what <code>4719340 + 397394</code>
was (and I didn&#39;t have a calculator), it would take a few minutes to work out.
Right now as I don&#39;t need to know.  Maybe I&#39;ll never need to know. I could put
those two numbers and the <code>+</code> sign on a piece of paper and stick it in my
pocket. If I ever wanted to know the answer, I could get the paper out and do
the maths. I should write &#39;Answer to silly blog sum&#39; on the top of the paper so
I know what the sum is about. And why I&#39;m carrying a piece of paper around.</p>

<p>That&#39;s lazy evaluation - holding on to an expression and only evaluating it when
you need it. It pairs neatly with <strong>memoization</strong> - keeping the results of
evaluated expressions in memory so that you don&#39;t have to evaluate them every
time you need their result.</p>

<p>(Which figures as, if I ever do work out what <code>4719340 + 397394</code> is, I never
want to work it out again. Ever.)</p>

<p>Let&#39;s take a look at doing some lazy evaluation in JavaScript - in other
languages, such as Clojure, we get <a href="http://clojure.org/sequences">a lot of this baked in</a>, but in JavaScript
there&#39;s some work to do. Let&#39;s take a simple function:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">add</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>And we&#39;d like to make that function lazy - with another function, naturally.
Something like:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">addThisLater</span> <span class="o">=</span> <span class="nx">lazyEval</span><span class="p">(</span> <span class="nx">add</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="p">);</span>

<span class="nx">addThisLater</span><span class="p">()</span> <span class="c1">//=&gt; 9</span>
</code></pre></div>
<p><code>lazyEval()</code> takes a function name, some more arguments, and returns a function
that, when it evaluates, returns the result of evaluating the passed in function
with the other arguments.</p>

<p>So far so good - but what needs to be returned from <code>lazyEval()</code> to make it work as
described above? As it turns out, not that much:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">lazyEval</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>And this is where things get exciting. We&#39;ve <a href="/2015/02/19/not-quite-js-currying/">seen <code>bind()</code> before</a>, so
let&#39;s take a look at <code>apply()</code>, what happens when we chain it with <code>bind()</code>, and
what&#39;s happening with <code>arguments</code> keyword.</p>

<h3><code>apply()</code></h3>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply"><code>apply()</code></a> is pretty simple - it&#39;s a method that all functions have. It takes
two arguments. When its evaluated it returns the result of evaluating the
function within the scope of the first argument (just like <code>bind()</code>). The second
argument is an array (or an array-like object - that&#39;s important) of arguments
for the function to be evaluated with. Which all sounds scary, but if I do this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">add</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">])</span> <span class="c1">//=&gt; 3</span>
</code></pre></div>
<p>I hope that begins to makes more sense. Now let&#39;s take a closer look at <code>arguments</code>.</p>

<h3><code>arguments</code> and Argument Binding</h3>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/arguments"><code>arguments</code></a> is an array-like object (it lacks a number of methods that arrays
have) which contains, unsurprisingly, all of the arguments passed to the current
function you&#39;re in the scope of - even ones not bound to a variable.</p>

<p>JavaScript functions, unlike some other languages, can take as many parameters
as you like. Which means that this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">//=&gt; 3</span>
</code></pre></div>
<p>works just like this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;peace&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;love&#39;</span><span class="p">],</span> <span class="p">{</span> <span class="nx">and</span><span class="o">:</span> <span class="s1">&#39;understanding&#39;</span> <span class="p">})</span> <span class="c1">//=&gt; 3</span>
</code></pre></div>
<p><code>add()</code> binds its first two arguments to <code>a</code> and <code>b</code>. Those extra arguments get
ignored - <code>add()</code> just goes on adding as usual. But that does not mean that
those arguments go nowhere. They&#39;re still available to the function in the
<code>arguments</code> <del>array</del> array-like object.</p>

<p>Look, try this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">echo</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">arguments</span>
<span class="p">}</span>

<span class="nx">echo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">//=&gt; { 0: 1 }</span>

<span class="nx">echo</span><span class="p">(</span><span class="s1">&#39;peace&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;love&#39;</span><span class="p">],</span> <span class="p">{</span> <span class="nx">and</span><span class="o">:</span> <span class="s1">&#39;understanding&#39;</span> <span class="p">})</span>
<span class="c1">//=&gt; { &#39;0&#39;: &#39;peace&#39;,&#39;1&#39;: [ &#39;love&#39; ], &#39;2&#39;: { and: &#39;understanding&#39; } }</span>

<span class="nx">echo</span><span class="p">(</span><span class="s1">&#39;faith&#39;</span><span class="p">,</span> <span class="s1">&#39;hope&#39;</span><span class="p">,</span> <span class="s1">&#39;charity&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="c1">//=&gt; &#39;charity&#39;</span>
</code></pre></div>
<p>OK, back on track. When <code>apply(fn, arguments)</code> is evaluated, it is passing the
arguments <code>fn, 4, 5</code> along to the function that <code>apply()</code> is being called
on. Namely, in this case, <code>bind()</code>.</p>

<p>(As a comparison, if <code>apply()</code> was replaced by its close cousin, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call"><code>call()</code></a>,
which takes more traditional looking arguments, it would look like this:
<code>bind.call(fn, fn, 4, 5)</code>)</p>

<p><code>fn, 4, 5</code> gets passed along to <code>bind()</code>, where <code>fn</code> becomes the <code>this</code> argument
for <code>bind()</code>, providing the scope, and the <code>4, 5</code> get bound as the arguments of
the function that <code>bind()</code> is being called on (in our examples, <code>add()</code>). And so
we get the <code>add()</code> function back, but with all its arguments already bound,
ready to be evaluated with a flick of our <code>()</code>.</p>

<h3>Memoization</h3>

<p>All of which is great, but what&#39;s the point if you have to evaluate the function
every time it&#39;s called? Wouldn&#39;t it be better if the function &#39;remembered&#39; the
result, and returned the remembered result the second time it was called rather
than evaluating it all over again? Or, to continue the increasingly strained
example, I should write the answer down on my piece of paper once I&#39;ve worked it
out the first time, rather than having to do the sum every time I need to know
the answer.</p>

<p>And that&#39;s <a href="https://en.wikipedia.org/wiki/Memoization">memoization</a>, a way of optimizing code so that it will return cached
results for the same inputs. This might get a little more complicated with
functions that have more than one input, but for our little <code>lazyEval</code> function
it&#39;s not all that hard (there&#39;s no arguments at all!):</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">lazyEvalMemo</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">lazyEval</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I remember this one!&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">result</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Let me work this out for the first time...&quot;</span><span class="p">);</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="nx">lazyEval</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Let&#39;s give it a function - a <code>sum</code> that does a little reporting for us...</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">sum</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m calculating!&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>And let it rip!</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">lazyMemoSum</span> <span class="o">=</span> <span class="nx">lazyEvalMemo</span><span class="p">(</span><span class="nx">sum</span><span class="p">,</span> <span class="mi">4719340</span><span class="p">,</span> <span class="mi">397394</span><span class="p">)</span>

<span class="nx">lazyMemoSum</span><span class="p">()</span>
<span class="c1">//=&gt; Let me work this out for the first time...</span>
<span class="c1">//=&gt; I&#39;m calculating!</span>
<span class="c1">//=&gt; 5116734</span>

<span class="nx">lazyMemoSum</span><span class="p">()</span>
<span class="c1">//=&gt; I remember this one!</span>
<span class="c1">//=&gt; 5116734</span>
</code></pre></div>
<p>It does the calculation the first time, and every subsequent call uses the
memoized result.</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2015/03/21/brew-cask/">
            Brew Cask
            <small>21 Mar 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/02/19/not-quite-js-currying/">
            (not quite) Currying in JavaScript
            <small>19 Feb 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/02/14/javascript-arrays/">
            Arrays in JavaScript
            <small>14 Feb 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
